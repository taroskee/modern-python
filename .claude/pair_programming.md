# ペアプログラミングワークフロー

## 概要
このドキュメントは、Modern Python開発環境におけるペアプログラミングのワークフローを概説します。TDD（テスト駆動開発）の実践、適切なコード品質管理、知識の蓄積を確保することを目的としています。

## タスクワークフロープロセス

### 1. タスクの選定と計画
**Claude の作業:**
- `project_plan_phase_1.md` または `TODO.md` から次のタスクを選択
- タスクの要件と受け入れ基準を確認
- 簡単な実装計画を作成（2～3個の箇条書き）
- **実装に入る前に人間に計画を確認すること**

### 2. 実装準備
**Claude の作業:**
- 簡易計画が人間に承認された後、詳細な実装計画を作成
- TodoWrite ツールを使って実装用のToDoリストを作成
- `CLAUDE.md` を確認して、プロジェクト固有のコマンドや注意点を参照
- 現在の状態を理解するために、関連する既存ファイルを読む
- TDDの場合、まず失敗するテストを書く準備

### 3. TDD実装サイクル

#### RED フェーズ
**Claude の作業:**
- 機能要件に基づいて失敗するテストを作成
- `pytest tests/test_[module].py` でテストが失敗することを確認
- テストが適切に失敗する（期待通りのエラー）ことを検証

#### GREEN フェーズ
**Claude の作業:**
- テストを通す最小限の実装を作成
- `make test` でテストが成功することを確認
- 過度な実装を避け、シンプルさを保つ

#### REFACTOR フェーズ
**Claude の作業:**
- コードの可読性と保守性を改善
- `make format` でコードをフォーマット
- `make lint` でコード品質をチェック
- すべてのテストが引き続き成功することを確認

### 4. 品質保証と検証
**Claude の作業:**
- `make all` を実行して全体的な品質チェック
  - Ruff によるリント
  - pytest によるテスト
  - Pyright による型チェック
- Dockerビルドの確認（必要な場合）：
  ```bash
  docker build -f .devcontainer/Dockerfile .
  ```
- CI/CDパイプラインのローカル検証

### 5. 人間への検証依頼
**Claude の作業:**
- 実装した内容の要約を提示
- 確認・テストすべき内容をリストアップ
- **人間が検証するための具体的な手順を記載**

**フォーマット例：**
> ## タスク「[タスク名]」の実装完了！
>
> **実施内容：**
> - [主な変更点の箇条書き]
> - テストカバレッジ: X%
> - 追加/変更したファイル数: Y
>
> **検証手順：**
> 1. テスト実行: `make test`
> 2. リント確認: `make lint`
> 3. 型チェック: `make type`
> 4. 機能確認:
>    ```python
>    # 実装した機能の使用例
>    from src.module import function
>    result = function(input)
>    assert result == expected
>    ```
>
> **期待される結果：**
> - すべてのテストがパス
> - リントエラーなし
> - 型エラーなし
> - [具体的な機能の動作確認]
>
> **ご確認お願いします！**

### 6. 人間によるレビューとフィードバック
**人間の作業:**
- コードレビューを実施
- `make test` でテストを実行
- 機能要件が満たされているかを確認
- フィードバックを提供（承認または修正依頼）

**問題があった場合：**
- 人間が問題点や改善点を指摘
- Claude が問題を調査して修正
- TDDサイクルに戻って修正を実施
- 検証が成功するまで繰り返す

### 7. タスクの完了
**人間が成功を確認した後の Claude の作業:**
- `project_plan_phase_1.md` または `TODO.md` でタスクを完了にマーク
- TodoListを完了に更新
- `technical_considerations.md` に学んだことを追記
- 必要に応じてドキュメントを更新

## ドキュメントの更新

### 各タスク中に更新すべきファイル

#### technical_considerations.md の更新
- 技術的な決定とその理由を記録
- 遭遇した問題とその解決方法を記録
- パフォーマンスに関する考慮事項を記録
- よくある落とし穴と対策を記録
- 今後の改善点を記載

#### CLAUDE.md の更新
- 新しく発見したコマンドやツールを追加
- プロジェクト固有の注意点を更新

#### README.md の更新（必要に応じて）
- 新機能の使用方法を追加
- インストール手順の更新
- コマンド例の追加

## 品質チェックリスト

### タスクを完了としてマークする前に
- [ ] TDDサイクル（RED→GREEN→REFACTOR）を完了
- [ ] すべてのテストがパス（`make test`）
- [ ] リントエラーなし（`make lint`）
- [ ] コードがフォーマット済み（`make format`）
- [ ] 型チェックをパス（`make type`）
- [ ] ドキュメントが更新済み
- [ ] 人間によるレビューが完了

### Python コード品質基準
- 型ヒントを適切に使用（Python 3.13の機能を活用）
- PEP 8 スタイルガイドに準拠（Ruffで自動化）
- 関数は小さく、単一責任の原則に従う
- docstring でドキュメント化
- エラーハンドリングを適切に実装
- テストカバレッジ 80% 以上を目指す

## コミュニケーションパターン

### タスク開始時
Claude: 「タスク「[タスク名]」を開始します。私の計画：[簡単なプラン]。このアプローチでよろしいですか？」

### TDD RED フェーズ
Claude: 「失敗するテストを作成しました。[テスト内容の説明]」

### TDD GREEN フェーズ
Claude: 「テストを通す実装を完了しました。」

### TDD REFACTOR フェーズ
Claude: 「コードをリファクタリングしました。[改善点の説明]」

### 検証依頼時
Claude: 「タスク「[タスク名]」の実装完了！[要約]。ご確認をお願いします。」

### 人間の確認後
Claude: 「了解です！タスクを完了としてマークし、次のタスクに進みます。」

## 緊急対応

### タスクが複雑すぎる場合
- より小さなサブタスクに分割
- 各サブタスクで TDD サイクルを実施
- 分割内容を `TODO.md` に記録
- 新しいアプローチについて人間の承認を得る

### 技術的な問題で行き詰まった場合
- 問題点を `technical_considerations.md` に記録
- エラーメッセージと試した解決策を明記
- 代替案を2～3個提案
- 人間に助言を求める

### CI/CD が失敗した場合
- GitHub CLI でログを確認：
  ```bash
  gh run list --limit 5
  gh run view [RUN_ID] --log-failed
  ```
- ローカルで再現を試みる
- `technical_considerations.md` のトラブルシューティングガイドを参照

## 成功指標

- テストカバレッジの向上（目標: 80%以上）
- CI/CD パイプラインの成功率（目標: 95%以上）
- コード品質メトリクスの改善
- ドキュメントの充実度
- 技術的負債の削減

## Python 開発特有の考慮事項

### 仮想環境の管理
- 常に仮想環境内で作業
- `uv venv` と `source .venv/bin/activate` を使用
- 依存関係は `pyproject.toml` で管理

### パッケージ管理
- `uv` を使用して高速なパッケージ管理
- `uv sync` で依存関係を同期
- バージョン固定で再現性を確保

### Docker との連携
- DevContainer 内での開発を推奨
- ローカルとコンテナ環境の一貫性を保つ
- `docker build` でビルドの成功を確認

---

このワークフローにより、品質を保ち、知識を蓄積しながら、Modern Python開発環境を継続的に改善していきます。
